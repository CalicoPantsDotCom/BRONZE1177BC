{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
        <div class="text-center my-5">
            {% if result.type == 'preservation' %}
            <div class="alert alert-success border-success">
                <h1 class="display-4">🕊️ VICTORY: Preservation Path</h1>
                <hr>
                <p class="lead">
                    You have averted the Bronze Age Collapse!
                </p>
                <p>
                    Through careful diplomacy, resource management, and cultural preservation,
                    you have reduced the Collapse to 0 and saved civilization from the brink.
                </p>
            </div>
            {% elif result.type == 'vacuum' %}
            <div class="alert alert-warning border-warning">
                <h1 class="display-4">⚡ VICTORY: Vacuum Path</h1>
                <hr>
                <p class="lead">
                    You have filled the power vacuum!
                </p>
                <p>
                    While the old order crumbled around you, your military strength ({{ result.final.military }})
                    allowed your kingdom to survive and dominate. The Collapse continues, but you endure.
                </p>
            </div>
            {% elif result.type == 'defeat' and result.reason == 'stability' %}
            <div class="alert alert-danger border-danger">
                <h1 class="display-4">💀 DEFEAT: Internal Collapse</h1>
                <hr>
                <p class="lead">
                    Your kingdom has fallen to internal strife.
                </p>
                <p>
                    Stability reached 0. Rebellions, riots, and social disorder have torn your civilization apart.
                    The people no longer recognize your authority.
                </p>
            </div>
            {% elif result.type == 'defeat' and result.reason == 'collapse' %}
            <div class="alert alert-danger border-danger">
                <h1 class="display-4">🔥 DEFEAT: Total Collapse</h1>
                <hr>
                <p class="lead">
                    The Bronze Age Collapse has consumed your kingdom.
                </p>
                <p>
                    Collapse reached 100. Trade networks failed, famine spread, and invaders overran your borders.
                    Your civilization is now lost to history.
                </p>
            </div>
            {% elif result.type == 'defeat' and result.reason == 'military' %}
            <div class="alert alert-danger border-danger">
                <h1 class="display-4">⚔️ DEFEAT: Military Defeat</h1>
                <hr>
                <p class="lead">
                    Your kingdom has been conquered.
                </p>
                <p>
                    Military reached 0. Your defenses crumbled and invaders swept through your lands.
                    Your civilization could not withstand the onslaught.
                </p>
            </div>
            {% elif result.type == 'defeat' and result.reason == 'time' %}
            <div class="alert alert-warning border-warning">
                <h1 class="display-4">⏳ DEFEAT: Time Ran Out</h1>
                <hr>
                <p class="lead">
                    You survived {{ result.final.max_turns }} turns, but did not achieve victory.
                </p>
                <p>
                    {% if result.final.collapse < 80 %}
                    You needed to reduce Collapse to 0 (Preservation Path), but ended at {{ result.final.collapse }}.
                    {% else %}
                    You pursued the Vacuum Path (Collapse ≥80), but your Military ({{ result.final.military }}) was too weak.
                    You needed at least 50 Military to dominate the power vacuum.
                    {% endif %}
                </p>
            </div>
            {% endif %}

            <!-- Final Stats -->
            <div class="card mt-4">
                <div class="card-header">
                    <strong>📊 Final Statistics</strong>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <h5>Resources</h5>
                            <ul class="list-unstyled">
                                <li>🌾 Grain: <strong>{{ result.final.grain }}</strong></li>
                                <li>🪵 Timber: <strong>{{ result.final.timber }}</strong></li>
                                <li>🔶 Bronze: <strong>{{ result.final.bronze }}</strong></li>
                            </ul>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h5>Metrics</h5>
                            <ul class="list-unstyled">
                                <li>⚔️ Military: <strong>{{ result.final.military }}</strong></li>
                                <li>🛡️ Stability: <strong>{{ result.final.stability }}</strong></li>
                                <li>👑 Prestige: <strong>{{ result.final.prestige }}</strong></li>
                            </ul>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h5>Crisis</h5>
                            <ul class="list-unstyled">
                                <li>🔥 Collapse: <strong>{{ result.final.collapse }}</strong></li>
                                <li>⏱️ Turns Survived: <strong>{{ result.final.turn - 1 }}</strong></li>
                            </ul>
                        </div>
                    </div>

                    <hr>

                    <h5>Buildings Constructed</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li>{{ '✅' if result.final.builds.bronze_mine else '❌' }} Bronze Mine</li>
                                <li>{{ '✅' if result.final.builds.granary else '❌' }} Granary</li>
                                <li>{{ '✅' if result.final.builds.barracks else '❌' }} Barracks</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li>{{ '✅' if result.final.builds.palace else '❌' }} Palace</li>
                                <li>{{ '✅' if result.final.builds.lighthouse else '❌' }} Lighthouse</li>
                                <li>{{ '✅' if result.final.builds.watchtower else '❌' }} Watchtower</li>
                            </ul>
                        </div>
                    </div>

                    <h5 class="mt-3">Technologies Researched</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li>{{ '✅' if result.final.tech.imperial_bureaucracy else '❌' }} Imperial Bureaucracy</li>
                                <li>{{ '✅' if result.final.tech.tin_trade_routes else '❌' }} Tin Trade Routes</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li>{{ '✅' if result.final.tech.phalanx_formation else '❌' }} Phalanx Formation</li>
                                <li>{{ '✅' if result.final.tech.diplomatic_marriage else '❌' }} Diplomatic Marriage</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <a href="{{ url_for('new_game', difficulty=result.final.difficulty) }}" class="btn btn-primary btn-lg px-5 me-2">
                    🔄 Play Again
                </a>
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-lg px-5">
                    📋 Main Menu
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
